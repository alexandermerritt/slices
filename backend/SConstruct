#! /usr/bin/env python

"""@file SConstruct
   @author Magdalena Slawinska magg@gatech.edu
   @date 2011-02-22
   @brief Building the network stuff
"""

Import('CUDA_ROOT',
       'INSTALL_DIR', 
       'BASE_ENV')

env = BASE_ENV.Clone()

env.Append(LIBS = ['pthread', 'rt', 'dl', 'uuid', 'cudart', 'cuda', 'shmgrp' ])
env.Append(LIBPATH=[CUDA_ROOT + '/lib64',  '../shmgrp'])
env.Append(CPPPATH=['.', '../include', CUDA_ROOT + '/include', '../shmgrp/include'])
#env.Append(CCFLAGS = ['-Werror'])

srclist = ['assembly/assembly.c', 'assembly/assemble.c', 'assembly/rpc.c',
            'assembly/export.c', '../common/io/sock.c', '../common/cuda/execute.c',
            '../common/cuda/rpc.c', '../common/cuda/marshal.c']

env.Program('runtime', ['runtime.c', srclist])
env.Program('localsink', ['localsink.c', srclist])
env.Program('assembly/remotesink', ['assembly/remotesink.c', srclist])

env.Install(INSTALL_DIR+'/bin', 'runtime')
env.Install(INSTALL_DIR+'/bin', 'localsink')
env.Install(INSTALL_DIR+'/bin', 'assembly/remotesink')
env.Install(INSTALL_DIR+'/bin', 'purge-system-resources.sh')
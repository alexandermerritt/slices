#! /usr/bin/env python

""" Build file for the interposing library. """

import os

__author__ = 'Alex Merritt'
__email__ = 'merritt.alex@gatech.edu'

Import('NODE_NAME', 'ENV', 'INSTALL_DIR')

env = ENV[NODE_NAME]

sources = []

files = os.listdir('./')
for src in files:
	(name,ext) = os.path.splitext(src)
	if '.c' == ext.lower():
		sources.append(src)

files = os.listdir('../backend/assembly/')
for src in files:
	(name,ext) = os.path.splitext(src)
	if '.c' == ext.lower():
		sources.append('../backend/assembly/' + src)

sources.remove('shm.c');
sources.append('../common/cuda/execute.c')
sources.append('../common/cuda/marshal_hidden.c')
sources.append('../common/cuda/rpc.c')
sources.append('../common/io/sock.c')
sources.append('../common/mq.c')

lib = env.SharedLibrary('libsf.so', sources)
env.Install(INSTALL_DIR + '/lib', lib)
